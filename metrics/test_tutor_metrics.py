# -*- coding: utf-8 -*-
"""–ú–µ—Ç—Ä–∏–∫–∏.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1XK7wIpvqFw5bCC-f2i4EaB2aEJ8ehw7G
"""

test_cases_1 = []
for i, question in enumerate(simple_c_questions_20, 1):
    config = {"configurable": {"thread_id": f"simple-{i}"}}
    result = agent.invoke({"messages": [HumanMessage(content=question)]}, config)

    rag_results = {}
    for msg in result["messages"]:
        if hasattr(msg, 'name') and msg.name and hasattr(msg, 'content') and msg.content.strip():
            rag_results[msg.name] = msg.content.strip()

    rag_context = list(rag_results.values())
    tools_used = list(rag_results.keys())
    agent_output = result["messages"][-1].content

    test_case = LLMTestCase(
        input=question,
        retrieval_context=rag_context,
        actual_output=f"Tools: {tools_used}\n\n–û—Ç–≤–µ—Ç: {agent_output}"
    )
    test_cases_simple_20.append(test_case)

print(f"\n‚úÖ 20 –ü–†–û–°–¢–´–• test cases –≥–æ—Ç–æ–≤—ã!")


test_cases_2 = []
c_2questions_20 = [
    "–ö–∞–∫ –Ω–∞–ø–∏—Å–∞—Ç—å if —É—Å–ª–æ–≤–∏–µ?",
    "–ß—Ç–æ —Ç–∞–∫–æ–µ typedef –≤ C?",
    "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç continue?",
    "–ß—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è void?",
    "–ö–∞–∫ –æ–±—ä—è–≤–∏—Ç—å –¥–≤—É–º–µ—Ä–Ω—ã–π –º–∞—Å—Å–∏–≤?",
    "–†–∞–∑–Ω–∏—Ü–∞ malloc –∏ calloc?",
    "–ö–∞–∫ –ø–µ—Ä–µ–¥–∞—Ç—å –º–∞—Å—Å–∏–≤ –≤ —Ñ—É–Ω–∫—Ü–∏—é?",
    "–ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–µ–∫—É—Ä—Å–∏—è?",
    "–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å #include?",
    "–ß—Ç–æ —Ç–∞–∫–æ–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ?",
    "–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –º–∞—Å—Å–∏–≤–∞?",
    "–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç const?",
    "–ß—Ç–æ —Ç–∞–∫–æ–µ static –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ?",
    "–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum?",
    "–ß—Ç–æ —Ç–∞–∫–æ–µ union?",
    "–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ NULL?",
    "sizeof –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä?",
    "–ö–∞–∫ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É –≤ C?",
    "fopen –¥–ª—è —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞?",
    "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç fprintf()?"
]

for i, question in enumerate(new_questions_20, 1):
    print(f"üß™ New Test {i}: {question}")

    config = {"configurable": {"thread_id": f"new-{i}"}}
    result = agent.invoke({"messages": [HumanMessage(content=question)]}, config)

    rag_results = {}
    for msg in result["messages"]:
        if hasattr(msg, 'name') and msg.name and hasattr(msg, 'content') and msg.content.strip():
            rag_results[msg.name] = msg.content.strip()

    rag_context = list(rag_results.values())
    tools_used = list(rag_results.keys())
    agent_output = result["messages"][-1].content

    test_case = LLMTestCase(
        input=question,
        retrieval_context=rag_context,
        actual_output=f"Tools: {tools_used}\n\n–û—Ç–≤–µ—Ç: {agent_output}"
    )
    test_cases.append(test_case)
    print(f"  üì¶ Tools: {tools_used}")

print(f"\n‚úÖ –ù–æ–≤—ã–µ 20 test cases –≥–æ—Ç–æ–≤—ã!")

–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –í–æ–ª–∫–æ–≤, [16.12.2025 19:41]
# Contextual Precision GEval
contextual_precision_geval = GEval(
    name="Contextual Precision",
    criteria="–û—Ü–µ–Ω–∏—Ç–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤–æ–ø—Ä–æ—Å—É.",
    model=eval_model,
    evaluation_steps=[
         "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ retrieval_context –≤–æ–ø—Ä–æ—Å—É input",
        "–¢—Ä–µ–±—É–µ—Ç—Å—è —Ö–æ—Ä–æ—à–µ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–Ω—è—Ç–∏–π C-–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è",
        "–ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é",
        "–í—ã—Å–æ–∫–∏–π –±–∞–ª–ª –ø—Ä–∏ —Ç–æ—á–Ω–æ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Ç–µ–º–∞—Ç–∏–∫–∏ –≤–æ–ø—Ä–æ—Å–∞ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞"
    ],
    evaluation_params=[LLMTestCaseParams.INPUT, LLMTestCaseParams.RETRIEVAL_CONTEXT],
)


answer_relevancy_geval = GEval(
    name="Answer Relevancy",
    criteria="–û—Ü–µ–Ω–∏—Ç–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ –∞–≥–µ–Ω—Ç–∞ –≤–æ–ø—Ä–æ—Å—É.",
    model=eval_model,
    evaluation_steps=[
        "–°—Ä–∞–≤–Ω–∏—Ç–µ actual_output (–æ—Ç–≤–µ—Ç –∞–≥–µ–Ω—Ç–∞) —Å input (–≤–æ–ø—Ä–æ—Å–æ–º)",
        "–û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –ø—Ä—è–º–æ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å",
        "–û—Ü–µ–Ω–∏—Ç–µ –ø–æ–ª–Ω–æ—Ç—É –∏ —Ç–æ—á–Ω–æ—Å—Ç—å –ø–æ–∫—Ä—ã—Ç–∏—è –∑–∞–ø—Ä–æ—à–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏",
        "–í—ã—Å–æ–∫–∏–π –±–∞–ª–ª –ø—Ä–∏ –ø—Ä—è–º–æ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ –æ—Ç–≤–µ—Ç–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é –≤–æ–ø—Ä–æ—Å–∞"
    ],
    evaluation_params=[LLMTestCaseParams.INPUT, LLMTestCaseParams.ACTUAL_OUTPUT],
)


faithfulness_geval = GEval(
    name="Faithfulness",
    criteria="–û—Ü–µ–Ω–∏—Ç–µ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.",
    model=eval_model,
    evaluation_steps=[
        "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –æ—Å–Ω–æ–≤–∞–Ω –ª–∏ actual_output –Ω–∞ —Ñ–∞–∫—Ç–∞—Ö –∏–∑ retrieval_context",
        "–û—Ç–≤–µ—Ç –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–µ–π –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ",
        "–®—Ç—Ä–∞—Ñ—É–π—Ç–µ –∑–∞ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ –∏ –≤—ã–¥—É–º–∞–Ω–Ω—ã–µ —Ñ–∞–∫—Ç—ã",
        "–í—ã—Å–æ–∫–∏–π –±–∞–ª–ª –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"
    ],
    evaluation_params=[LLMTestCaseParams.RETRIEVAL_CONTEXT, LLMTestCaseParams.ACTUAL_OUTPUT],
)


# GEval Tool Correctness
tool_correctness = GEval(
    name="Tool Correctness",
    criteria="–û—Ü–µ–Ω–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–∞ RAG tools –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞ –ø–æ C –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é.",
    model=eval_model,
    evaluation_steps=[
        "–í 'input' - –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
        "–í 'retrieval_context' - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–∑–≤–∞–Ω–Ω—ã—Ö tools",
        "–í 'actual_output' - —Å–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö tools + –æ—Ç–≤–µ—Ç –∞–≥–µ–Ω—Ç–∞",
        "syntax_search = –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ/—Ç–∏–ø—ã/printf",
        "control_flow_search = —Ü–∏–∫–ª—ã/if/switch",
        "data_structures_search = —É–∫–∞–∑–∞—Ç–µ–ª–∏/–º–∞—Å—Å–∏–≤—ã/struct",
        "functions_search = —Ñ—É–Ω–∫—Ü–∏–∏/–ø—Ä–æ—Ç–æ—Ç–∏–ø—ã",
        "memory_files_search = malloc/—Ñ–∞–π–ª—ã",
        "1 tool = –ø—Ä–æ—Å—Ç–æ–π –≤–æ–ø—Ä–æ—Å, 2-3 tools = —Å–ª–æ–∂–Ω—ã–π",
        "–í—ã—Å–æ–∫–∏–π score –µ—Å–ª–∏ tools —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã –≤–æ–ø—Ä–æ—Å—É"
    ],
    evaluation_params=[LLMTestCaseParams.INPUT, LLMTestCaseParams.RETRIEVAL_CONTEXT, LLMTestCaseParams.ACTUAL_OUTPUT],
)